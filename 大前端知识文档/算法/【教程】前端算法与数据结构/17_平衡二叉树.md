# å¹³è¡¡äºŒå‰æ ‘

äºŒå‰æœç´¢æ ‘æ˜¯äºŒå‰æ ‘çš„ç‰¹ä¾‹ï¼Œå¹³è¡¡äºŒå‰æ ‘åˆ™æ˜¯äºŒå‰æœç´¢æ ‘çš„ç‰¹ä¾‹ã€‚

## ä»€ä¹ˆæ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Ÿ

åœ¨ä¸Šä¸€èŠ‚çš„æœ«å°¾ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡ä¸€é“çœŸé¢˜å’Œå¹³è¡¡äºŒå‰æ ‘æ‰“è¿‡äº¤é“ã€‚æ­£å¦‚é¢˜ç›®ä¸­æ‰€è¯´ï¼Œå¹³è¡¡äºŒå‰æ ‘ï¼ˆåˆç§° AVL Treeï¼‰æŒ‡çš„æ˜¯**ä»»æ„ç»“ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ç»å¯¹å€¼éƒ½ä¸å¤§äº 1** çš„äºŒå‰æœç´¢æ ‘ã€‚

## ä¸ºä»€ä¹ˆè¦æœ‰å¹³è¡¡äºŒå‰æ ‘ï¼Ÿ

å¹³è¡¡äºŒå‰æ ‘çš„å‡ºç°ï¼Œæ˜¯ä¸ºäº†é™ä½äºŒå‰æœç´¢æ ‘çš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ã€‚

å¤§å®¶çŸ¥é“ï¼Œå¯¹äºåŒæ ·ä¸€ä¸ªéå†åºåˆ—ï¼ŒäºŒå‰æœç´¢æ ‘çš„é€ å‹å¯ä»¥æœ‰å¾ˆå¤šç§ã€‚æ‹¿ `[1,2,3,4,5]` è¿™ä¸ªä¸­åºéå†åºåˆ—æ¥è¯´ï¼ŒåŸºäºå®ƒå¯ä»¥æ„é€ å‡ºçš„äºŒå‰æœç´¢æ ‘å°±åŒ…æ‹¬ä»¥ä¸‹ä¸¤ç§é€ å‹ï¼š

[![pA2PuK1.png](https://s21.ax1x.com/2024/11/15/pA2PuK1.png)](https://imgse.com/i/pA2PuK1)

[![pA2PKDx.png](https://s21.ax1x.com/2024/11/15/pA2PKDx.png)](https://imgse.com/i/pA2PKDx)

ç»“åˆå¹³è¡¡äºŒå‰æ ‘çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€æ£µäºŒå‰æ ‘æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œç¬¬äºŒæ£µäºŒå‰æ ‘æ˜¯æ™®é€šçš„äºŒå‰æœç´¢æ ‘ã€‚

ç°åœ¨ï¼Œå¦‚æœè¦ä½ åŸºäºä¸Šä¸€èŠ‚å­¦è¿‡çš„äºŒå‰æœç´¢æ ‘æŸ¥æ‰¾ç®—æ³•ï¼Œåœ¨å›¾ä¸Šä¸¤æ£µæ ‘ä¸Šåˆ†åˆ«æ‰¾å‡ºå€¼ä¸º 1 çš„ç»“ç‚¹ï¼Œé—®ä½ å„éœ€è¦æŸ¥æ‰¾å‡ æ¬¡ï¼Ÿåœ¨ 1 å·äºŒå‰æ ‘ä¸­ï¼ŒåŒ…æ‹¬æ ¹ç»“ç‚¹åœ¨å†…ï¼Œåªéœ€è¦æŸ¥æ‰¾ 3 æ¬¡ï¼›è€Œåœ¨ 2 å·äºŒå‰æ ‘ä¸­ï¼ŒåŒ…æ‹¬æ ¹ç»“ç‚¹åœ¨å†…ï¼Œä¸€å…±éœ€è¦æŸ¥æ‰¾ 5 æ¬¡ã€‚

å¤§å®¶å¯ä»¥ä»”ç»†æƒ³æƒ³ï¼Œä¸ºä»€ä¹ˆè¦ç»™äºŒå‰æ ‘çš„å·¦å³å­æ ‘å’Œæ ¹ç»“ç‚¹ä¹‹é—´å¼ºåŠ ä¸Šæ’åºå…³ç³»ä½œä¸ºçº¦æŸï¼Œè¿›è€Œåˆ›é€ å‡ºäºŒå‰æœç´¢æ ‘è¿™ç§ä¸œè¥¿å‘¢ï¼Ÿéš¾é“åªæ˜¯ä¸ºäº†è£…xå—ï¼Ÿå½“ç„¶ä¸æ˜¯ã€‚äºŒå‰æœç´¢æ ‘çš„å¦™å¤„å°±åœ¨äºå®ƒ**æŠŠã€äºŒåˆ†ã€‘è¿™ç§æ€æƒ³ä»¥æ•°æ®ç»“æ„çš„å½¢å¼è¡¨è¾¾äº†å‡ºæ¥**ã€‚åœ¨ä¸€ä¸ªæ„é€ åˆç†çš„äºŒå‰æœç´¢æ ‘é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹æ¯”å½“å‰ç»“ç‚¹å’Œç›®æ ‡å€¼ä¹‹é—´çš„å¤§å°å…³ç³»ï¼Œç¼©å°ä¸‹ä¸€æ­¥çš„æœç´¢èŒƒå›´ï¼ˆæ¯”å¦‚åªæœç´¢å·¦å­æ ‘æˆ–è€…åªæœç´¢å³å­æ ‘ï¼‰ï¼Œè¿›è€Œè§„é¿æ‰ä¸å¿…è¦çš„æŸ¥æ‰¾æ­¥éª¤ï¼Œé™ä½æœç´¢è¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªäºŒå‰æœç´¢æ ‘ä¸¥é‡ä¸å¹³è¡¡ï¼Œæ¯”å¦‚è¯´ä¸Šé¢è¿™æ£µé“¾å¼æœç´¢æ ‘ï¼š

[![pA2PKDx.png](https://s21.ax1x.com/2024/11/15/pA2PKDx.png)](https://imgse.com/i/pA2PKDx)

æ¯ä¸€ä¸ªç»“ç‚¹çš„å³å­æ ‘éƒ½æ˜¯ç©ºçš„ï¼Œè¿™æ ·çš„ç»“æ„éå¸¸ä¸åˆç†ï¼Œå®ƒä¼šå¸¦æ¥é«˜è¾¾ `O(N)` çš„æ—¶é—´å¤æ‚åº¦ã€‚è€Œå¹³è¡¡äºŒå‰æ ‘ç”±äºåˆ©ç”¨äº†äºŒåˆ†æ€æƒ³ï¼ŒæŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä»…ä¸º `O(logN)`ã€‚å› æ­¤ï¼Œä¸ºäº†ä¿è¯äºŒå‰æœç´¢æ ‘èƒ½å¤Ÿç¡®å®ä¸ºæŸ¥æ‰¾æ“ä½œå¸¦æ¥æ•ˆç‡ä¸Šçš„æå‡ï¼Œæˆ‘ä»¬æœ‰å¿…è¦åœ¨æ„é€ äºŒå‰æœç´¢æ ‘çš„è¿‡ç¨‹ä¸­ç»´æŒå…¶å¹³è¡¡åº¦ï¼Œè¿™å°±æ˜¯å¹³è¡¡äºŒå‰æ ‘çš„æ¥ç”±ã€‚

## å‘½é¢˜æ€è·¯è§£è¯»

å¹³è¡¡äºŒå‰æ ‘å’ŒäºŒå‰æœç´¢æ ‘ä¸€æ ·ï¼Œéƒ½è¢«å½’ç±»ä¸ºâ€œç‰¹æ®Šâ€çš„äºŒå‰æ ‘ã€‚å¯¹äºè¿™æ ·çš„æ•°æ®ç»“æ„æ¥è¯´ï¼Œå…¶â€œç‰¹æ®Šâ€ä¹‹å¤„ä¹Ÿæ­£æ˜¯å…¶è€ƒç‚¹æ‰€åœ¨ï¼Œå› æ­¤çœŸé¢˜å¾€å¾€ç¨³å®šåœ°åˆ†å¸ƒåœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹å‘ï¼š

* å¯¹ç‰¹æ€§çš„è€ƒå¯Ÿï¼ˆæœ¬èŠ‚ä»¥å¹³è¡¡äºŒå‰æ ‘çš„åˆ¤å®šä¸ºä¾‹ï¼‰
* å¯¹æ“ä½œçš„è€ƒå¯Ÿï¼ˆæœ¬èŠ‚ä»¥å¹³è¡¡äºŒå‰æ ‘çš„æ„é€ ä¸ºä¾‹ï¼‰

### 1. å¹³è¡¡äºŒå‰æ ‘çš„åˆ¤å®š

```cmd
é¢˜ç›®æè¿°ï¼šç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯é«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ã€‚
æœ¬é¢˜ä¸­ï¼Œä¸€æ£µé«˜åº¦å¹³è¡¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼š ä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ã€‚

ç¤ºä¾‹ 1: ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]
    3
   / \
  9  20
    /  \
   15   7

è¿”å› true ã€‚

ç¤ºä¾‹ 2: ç»™å®šäºŒå‰æ ‘ [1,2,2,3,3,null,null,4,4]
       1
      / \
     2   2
    / \
   3   3
  / \
 4   4

 è¿”å› false ã€‚
```

#### 1.1 ğŸ’¡æ€è·¯åˆ†æ

æ—¢ç„¶æ˜¯è€ƒå¯Ÿåˆ¤æ–­ï¼Œé‚£ä¹ˆå°±ä»å®šä¹‰å…¥æ‰‹ã€‚

> å¹³è¡¡äºŒå‰æ ‘æ˜¯ä»»æ„ç»“ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ç»å¯¹å€¼éƒ½ä¸å¤§äº 1 çš„äºŒå‰æœç´¢æ ‘ã€‚

å…³é”®åœ¨äºï¼š

1. ä»»æ„ç»“ç‚¹
2. å·¦å³å­æ ‘çš„é«˜åº¦å·®ç»å¯¹å€¼éƒ½ä¸å¤§äº 1
3. äºŒå‰æœç´¢æ ‘

å½“ç„¶ï¼Œè¿™é‡Œç”±äºé¢˜ç›®ä¸­åªè¦æ±‚é«˜åº¦å¹³è¡¡ï¼Œæ‰€ä»¥ç¬¬ä¸‰ç‚¹æš‚æ—¶ä¸ç”¨å…³å¿ƒã€‚

æ¥çœ‹ 1ã€2ï¼Œæ—¢ç„¶æ˜¯ä»»æ„ç»“ç‚¹ï¼Œé‚£ä¹ˆå°±å­˜åœ¨ä¸€ä¸ªé‡å¤çš„é€»è¾‘ï¼Œå³ï¼šä¸€æ£µæ ‘çš„å·¦å³å­æ ‘é«˜åº¦å·®ç»å¯¹å€¼ä¸å¤§äº 1ï¼Œä¸”å…¶å·¦å³å­æ ‘ä¹Ÿæ»¡è¶³è¿™ä¸ªæ¡ä»¶ã€‚

æ—¢ç„¶æ˜¯é‡å¤çš„é€»è¾‘ï¼Œå°±è¦è”æƒ³åˆ° ---ã€é€’å½’ã€‘ï¼

* é€’å½’å¼ï¼šè®¡ç®—æ ‘çš„å·¦å³å­æ ‘é«˜åº¦ï¼Œå¾—åˆ°å·¦å³å­æ ‘é«˜åº¦çš„å·®å€¼ï¼Œåˆ¤æ–­æ˜¯å¦å°äº 1
* é€’å½’è¾¹ç•Œï¼šå­˜åœ¨å­æ ‘é«˜åº¦å·®å€¼å¤§äº 1/æ‰€æœ‰å­æ ‘éƒ½æ»¡è¶³æ¡ä»¶

#### 1.2 ç¼–ç å®ç°

```js
const isBalanced = function (root) {
  // flagï¼Œä¸€æ—¦å‡ºç°ä¸æ»¡è¶³çš„å­æ ‘ï¼Œå°±è¯´æ˜ä¸æ˜¯é«˜åº¦å¹³è¡¡äºŒå‰æ ‘
  let flag = true;

  // é€’å½’æ–¹æ³•ï¼Œè®¡ç®—æ ‘çš„é«˜åº¦
  function dfs(root) {
    // è¾¹ç•Œï¼šå¦‚æœå½“å‰æ ‘ä¸ºç©ºæ ‘ï¼Œæˆ–è€…ä¹‹å‰å·²ç»æœ‰ä¸æ»¡è¶³çš„å­æ ‘äº†ï¼Œåˆ™ç›´æ¥è¿”å› 0
    if (!root || !flag) {
      return 0;
    }

    // è®¡ç®—å·¦å­æ ‘é«˜åº¦
    let left = dfs(root.left);
    // è®¡ç®—å³å­æ ‘é«˜åº¦
    let right = dfs(root.right);

    // æ¯”è¾ƒå·¦å³å­æ ‘é«˜åº¦
    if (Math.abs(left - right) > 1) {
      flag = false;
      // åç»­ä¸éœ€è¦å†åˆ¤æ–­äº†ï¼ŒåŠæ—¶åœæ­¢
      return 0;
    }

    return Math.max(left, right) + 1;
  }

  // å¼€å§‹é€’å½’
  dfs(root);

  return flag;
};
```

### 2. å¹³è¡¡äºŒå‰æ ‘çš„æ„é€ ï¼ˆäºŒå‰æœç´¢æ ‘ -> å¹³è¡¡äºŒå‰æ ‘ï¼‰

```cmd
é¢˜ç›®æè¿°ï¼šç»™ä½ ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼Œè¯·ä½ è¿”å›ä¸€æ£µå¹³è¡¡åçš„äºŒå‰æœç´¢æ ‘ï¼Œæ–°ç”Ÿæˆçš„æ ‘åº”è¯¥ä¸åŸæ¥çš„æ ‘æœ‰ç€ç›¸åŒçš„èŠ‚ç‚¹å€¼ã€‚
å¦‚æœä¸€æ£µäºŒå‰æœç´¢æ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ä¸¤æ£µå­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡ 1 ï¼Œæˆ‘ä»¬å°±ç§°è¿™æ£µäºŒå‰æœç´¢æ ‘æ˜¯å¹³è¡¡çš„ã€‚
å¦‚æœæœ‰å¤šç§æ„é€ æ–¹æ³•ï¼Œè¯·ä½ è¿”å›ä»»æ„ä¸€ç§ã€‚

ç¤ºä¾‹ï¼š
```

[![pA2iNYF.png](https://s21.ax1x.com/2024/11/15/pA2iNYF.png)](https://imgse.com/i/pA2iNYF)

```cmd
è¾“å…¥ï¼šroot = [1,null,2,null,3,null,4,null,null]
è¾“å‡ºï¼š[2,1,3,null,null,null,4]
è§£é‡Šï¼šè¿™ä¸æ˜¯å”¯ä¸€çš„æ­£ç¡®ç­”æ¡ˆï¼Œ[3,1,4,null,2,null,null] ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¡Œçš„æ„é€ æ–¹æ¡ˆã€‚

æç¤ºï¼š
æ ‘èŠ‚ç‚¹çš„æ•°ç›®åœ¨ 1 åˆ° 10^4 ä¹‹é—´ã€‚ æ ‘èŠ‚ç‚¹çš„å€¼äº’ä¸ç›¸åŒï¼Œä¸”åœ¨ 1 åˆ° 10^5 ä¹‹é—´ã€‚
```

#### 2.1 ğŸ’¡æ€è·¯åˆ†æ

åœ¨ä¸Šä¸€èŠ‚çš„æœ€åï¼Œæˆ‘ä»¬ä¹Ÿå°è¯•è¿‡å¹³è¡¡äºŒå‰æ ‘çš„æ„é€ ï¼Œä½†æ˜¯å½“æ—¶æˆ‘ä»¬æ˜¯ç›´æ¥å°†ä¸€ä¸ªæœ‰åºæ•°ç»„è½¬åŒ–ä¸ºå¹³è¡¡äºŒå‰æ ‘ã€‚

é‚£ä¹ˆè¿™ä¸¤é“é¢˜ä¼šä¸ä¼šæœ‰ä»€ä¹ˆè”ç³»å‘¢ï¼Ÿ

å›æƒ³ä¸€ä¸‹äºŒå‰æœç´¢æ ‘çš„ç‰¹æ€§ï¼šäºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†æ˜¯ä¸€ä¸ªæœ‰åºæ•°ç»„ï¼

è¿™ä¸å°±è”ç³»èµ·æ¥äº†å—ï¼Ÿå¦‚æœèƒ½æŠŠä¸­åºéå†åºåˆ—æ±‚å‡ºæ¥ï¼Œè¿™é“é¢˜æ˜¯ä¸æ˜¯å°±è·Ÿä¹‹å‰åšè¿‡é‚£é“æ˜¯ä¸€æ¨¡ä¸€æ ·çš„è§£æ³•äº†ï¼Ÿæ‰€ä»¥ï¼Œè¿™é“é¢˜çš„æ±‚è§£æ€è·¯å°±æ˜¯ï¼š

1. ä¸­åºéå†æ±‚å‡ºæœ‰åºæ•°ç»„
2. é€ä¸ªå°†äºŒåˆ†å‡ºæ¥çš„æ•°ç»„å­åºåˆ—â€œæâ€èµ·æ¥å˜æˆäºŒå‰æœç´¢æ ‘


#### 2.2 ç¼–ç å®ç°

```js
/**
 * @param {TreeNode} root
 * @return {TreeNode}
 */
const balanceBST = function (root) {
  // 1. æ±‚äºŒå‰æœç´¢æ ‘çš„ä¸­åºåºåˆ—
  let mid = [];
  inorder(root);

  // 2. ç”±æœ‰åºåºåˆ—å¾—åˆ°å¹³è¡¡äºŒå‰æ ‘
  return buildAVL(0, mid.length - 1);

  // å·¥å…·å‡½æ•°1ï¼šäºŒå‰æ ‘çš„ä¸­åºéå†åºåˆ—
  function inorder(root) {
    if (!root) {
      return;
    }
    inorder(root.left);
    mid.push(root.val);
    inorder(root.right);
  }

  // å·¥å…·å‡½æ•°2ï¼šå°†æœ‰åºåºåˆ—è½¬åŒ–ä¸ºå¹³è¡¡äºŒå‰æ ‘
  function buildAVL(low, high) {
    // å¦‚æœ low > highï¼Œåˆ™è¯´æ˜å½“å‰åºåˆ—å·²ç»å¤„ç†å®Œæ¯•
    if (low > high) {
      return null;
    }

    // å¦åˆ™ï¼Œé€šè¿‡ low å’Œ high æ‰¾åˆ°åºåˆ—çš„ä¸­é—´å…ƒç´ ï¼Œå°†å…¶ä½œä¸ºæ ¹èŠ‚ç‚¹
    let mid = Math.floor(low + (high - low) / 2);
    let root = new TreeNode(mid[mid]);
    // æ ¹æ®å·¦å³åºåˆ—ç»§ç»­æ„é€ å·¦å³å­æ ‘
    root.left = buildAVL(low, mid - 1);
    root.right = buildAVL(mid + 1, high);

    return root;
  }
};
```