# 浏览器渲染原理

## 前言

浏览器渲染，就是指通过浏览器访问网站时，浏览器将网站内容展示再用户界面上的过程。

具体来说，是由浏览器的**网络线程**先请求网站资源，获取到 **HTML 文档**后，产生一个**渲染任务**，并将其传递给**渲染线程的消息队列**。然后，在**事件循环**的作用下，**渲染主线程**取出消息队列中的渲染任务，开始真正的渲染流程。

[![pF7zY9O.md.png](https://s21.ax1x.com/2024/04/02/pF7zY9O.md.png)](https://imgse.com/i/pF7zY9O)

至于真正的渲染流程，实际上就是将我们打包得到的 HTML、CSS、JS 等文件，经过操作后在浏览器中以页面的形式展示出来，也即**将静态资源转化为可视化界面**的过程，这一过程主要是由浏览器的渲染进程负责。

由于渲染机制比较复杂，所以渲染流程在执行过程中会被分为多个子阶段，输入的静态资源经过这些子阶段，最后输出可视化界面。我们将一整个处理流程称为【**渲染流水线**】，其大致流程如下：

[![pFHZlb8.md.png](https://s21.ax1x.com/2024/04/02/pFHZlb8.md.png)](https://imgse.com/i/pFHZlb8)

可以看到，包含5个阶段：

* 【DOM 树构建】--- 渲染引擎使用 HTML 解析器解析 HTML 文档，将各个 HTML 元素逐个转化为 DOM 节点，从而生成 DOM 树。
* 【CSSOM 树构建】--- 渲染引擎使用 CSS 解析器解析 CSS，并将其转化为 CSS 对象，并将这些 CSS 对象组装起来，构建 CSSOM 树。
* 【渲染树构建】--- 等待前两个阶段完成后，浏览器会根据 DOM 树和 CSSOM 树构建出一棵渲染树。
* 【页面布局】--- DOM创建之后，渲染引擎将其中的元素对象与样式规则进行结合，可以得到渲染树。布局则是针对渲染树，计算其各个元素的大小、位置等布局信息。
* 【页面绘制】--- 使用图形库将布局计算后的渲染树绘制成可视化的图像结果。

其中，后面的【页面布局】和【页面绘制】又可以细分为多个子阶段，这个我们后面再说。

现在，让我们先关注前三个阶段：

## Step1： DOM 树构建

首先，为什么要构建 DOM 树呢？这是因为，浏览器无法直接理解和使用 HTML，所以需要将 HTML 转化为浏览器能够理解的结构，即 DOM 树。

学习过数据结构的应该都对树结构很熟悉了，这里就只简单提一下，树就是**由结点或顶点和边组成的，且不存在任何环的数据结构**。
