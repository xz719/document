# Git 快照 Snapshot

在对 Git 基础的学习过程中，我们了解了 Git 仓库的基本结构：

1. **工作目录**
2. **暂存区**
3. **版本库**，即 .git 仓库

![在这里插入图片描述](https://img-blog.csdnimg.cn/5c4dbef6a08041ac8d9b0db4651b1a94.png#pic_center)

下面我们就通过一次修改、暂存以及提交的工作流程，来理解快照（Snapshot）的概念。

现在，我们在工作目录下新增三个文件：`test1.txt`、`test2.txt`、`test3.txt`。然后，我们执行 `git add` 将这三个文件暂存。那么，此时这个指令做了哪些事呢？

* 首先，它将这三个文件分别创建3个**校验和**添加到**暂存区**中。在前面对 Git 基础的学习中， 我们了解到，校验和是 Git 通过 **SHA-1 哈希算法**遍历每一个文件并根据文件内容等信息，为文件创建的一个**唯一索引**。因此，我们可以通过这个唯一索引，取出相应文件的完整内容。
* 然后，Git 对当前的暂存区拍了一张“照片”，即**快照**，并将快照放入了**版本库**中。那么快照里面包括哪些内容呢？快照中包括前面所说的**唯一文件索引**和**相应文件的完整内容**，其采用类似于 **key-value** 的结构存储这些信息，同时，Git 使用内置的**blob对象**来存储这些文件的快照。

![在这里插入图片描述](https://img-blog.csdnimg.cn/5275d88f59d0427caf6188caf525d632.png#pic_center)

暂存修改后，执行 `git commit`，这条指令又做了哪些事情呢？

* 首先，Git 通过一个内置的 **tree 对象**，将**文件的目录结构**保存下来。
* 然后，Git 在这个 tree 对象上又包裹了一层，创建了一个 **commit 对象**，这个 commit 对象也是 Git 进行版本管理的最终对象。**commit 对象中包含了 tree 对象以及作者、提交描述等信息**。

![在这里插入图片描述](https://img-blog.csdnimg.cn/52c0dc6d3aa740748bd346140be82a79.png#pic_center)

同时，需要注意的是，**在 tree 对象中，实际上包含了对快照的引用，即对所有文件索引的引用。**

因此，我们可以总结一下快照的概念：

> 快照就是在执行 `git add` 和 `git commit` 时，对当前暂存区的情况拍摄的一张"照片"，这个照片中涵盖的若干信息将被存放到 git 版本库下。这些若干信息包括：
>
> 1. 文件的索引+文件的完整内容（【key-value】结构）
> 2. 文件的目录结构
> 3. 提交信息
>
> 这三者分别用 Git 内置的 blob，tree，commit 对象进行存储。

接下来，我们再次对 `test2.txt` 文件进行修改，然后再执行 `git add` 和 `git commit` 操作：

![在这里插入图片描述](https://img-blog.csdnimg.cn/35d8d31359ac441fa4d3fce8fac502ed.png#pic_center)

这里可以看到，在给当前暂存区拍完快照后，**Git 发现 `test1.txt` 和 `test3.txt` 的内容没有变化。因此它只把 `test2.txt` 的相关信息存入版本库，并生成了新 tree 和 commit 对象**。

同时，`旧test2.txt` 和 `新test2.txt` 信息是共存在版本库里的。因此 **Git 每次照下保存的都是文件的完整信息，而不是文件的差异**。

另外，暂存区的内容也不会随着 `git commit` 的完成而消失，因此“把暂存区文件提交上去”这种说法是不准确的，更准确的说法是，**暂存区保存着当前待提交的状态**，Git 对这个状态拍了照，然后把照片转换成若干信息存入版本库。
